<header>
    <div class="row server-row">
        <div class="col-xs-9">
            <div class="row">
                <div class="col col-xs-4"></div>
                <div class="col col-xs-4">
                    <div class="row">
                        <div class="col-xs-12">Origin</div>
                    </div>
                </div>
                <div class="col col-xs-4">
                    <div class="row">
                        <div class="col-xs-12">PowerUp</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col col-xs-3 diff"></div>
    </div>
</header>


<section>

    {% for score in scores %}
        <div class="row server-row">
            <div class="col-xs-9">
                <div class="row">
                    <div class="col col-xs-4">{{ score }}</div>
                    <div class="col col-xs-4">
                        <div class="row">
                            <div class="col-xs-12 {{ scores.get(score) }}1">
                                {% if status %}
                                    {{ status }}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="col col-xs-4">
                        <div class="row">
                            <div class="col-xs-12 {{ scores.get(score) }}2">
                                {% if status %}
                                    {{ status }}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col col-xs-3 diff"></div>
        </div>
    {% endfor %}



    <div class="row server-row">
        <div class="col-xs-9">
            <div class="row">
                <div class="col col-xs-4">Page Load Time</div>
            </div>
        </div>
        <div class="col col-xs-3 diff"></div>
    </div>


    {% for location in locations %}
        <div class="row server-row">
            <div class="col-xs-9">
                <div class="row">
                    <div class="col col-xs-4">
                        <img class="flag" src="/static/img/flag_vietnam.png" style="width: 40px; height: 24px;">
                        <span data-field="city">{{ location }}</span>
                    </div>

                    <div class="col col-xs-4">
                        <div class="row">
                            <div class="col-xs-12 location1" id="{{ locations.get(location).get('id') }}1">
                                {% if status %}
                                    {{ status }}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="col col-xs-4">
                        <div class="row">
                            <div class="col-xs-12 location2" id="{{ locations.get(location).get('id') }}2">
                                {% if status %}
                                    {{ status }}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col col-xs-3 diff"></div>
        </div>
    {% endfor %}


    <div class="row server-row">
        <video width="320" height="240" controls>
          <source src="" type="video/mp4">
          <source src="" type="video/ogg">
        Your browser does not support the video tag.
        </video>
    </div>

</section>

<script type="text/javascript" language="javascript" charset="utf-8">
    var slaver_servers = {{ slaver_servers | safe }}

    var master_location_id = '{{ master_location_id }}';

    function messageReceived(text, id, channel) {
        data = JSON.parse(text);
        var host = window.location.hostname;
        console.log(data);

        if (data.hasOwnProperty('is_slaver') == false){
            for (var key in data) {
                if (data['is_powerup_domain'] == true) {
                    var class_name = '.' + key + '1';
                }
                if (data['is_powerup_domain'] == false){
                    var class_name = '.' + key + '2';
                }

                if (key == 'pageload_time'){
                    if (data['is_powerup_domain'] == true) {
                        var name_id = '#' + master_location_id + '1';
                    }
                    if (data['is_powerup_domain'] == false) {
                        var name_id = '#' + master_location_id + '2';
                    }

                    $(name_id).empty();
                    $(name_id).append(data[key]);
                } else {
                    $(class_name).empty();
                    $(class_name).append(data[key]);
                }

            }
        } else {
            for (key in slaver_servers){
                if (data['is_powerup_domain'] == true) {
                    var name_id = '#' + slaver_servers[key]['id'] + '1';
                }
                if (data['is_powerup_domain'] == false) {
                    var name_id = '#' + slaver_servers[key]['id'] + '2';
                }

                var server_host = slaver_servers[key]['host'];
                if (host != server_host){
                    $(name_id).empty();
                    $(name_id).append(data['pageload_time']);
                }
            }
        }

    };

    var pushstream = new PushStream({
          host: window.location.hostname,
          port: window.location.port,
          modes: "stream"
    });

    pushstream.onmessage = messageReceived;
    pushstream.addChannel('{{ channel_id }}');
    pushstream.connect();


</script>


